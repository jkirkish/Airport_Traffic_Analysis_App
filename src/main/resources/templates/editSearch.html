<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Edit Search Information</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
   <link rel="stylesheet" type="text/css"  href="/css/editSearch.css">   
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
<label class="navbar-brand" for="flight-tracking">Flight Tracking</label>
<div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <a class="nav-link" href="/api/v1/users/index">Index</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/airportArrivalSearch">SearchForm</a>
        </li>
        <li class="nav-item">
           <a class="nav-link" href="/arrivalSearchRequests">SearchRequests</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/arrivals">Arrivals</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/departures">Departures</a>
        </li>
    </ul>
</div>
</nav>
<div class="container">
    <h1>Edit Search Information</h1>
    <form id="editForm" th:action="@{/search/save/{id}(id=${search.id})}"  method="post">
        <input type="hidden" name="id" th:value="${search.id}">
        <div class="form-group">
        <label for="searchType">Search Type:</label>
        <select class="form-control" id="searchType" name="searchType" required>
            <option value="arrival">Arrival</option>
            <option value="departure">Departure</option>
        </select>
    </div>
        <div class="form-group">
            <label for="airport">Airport:</label>
            <input type="text" class="form-control" id="airport" name="airport" th:value="${search.airport}">
        </div>
        <div class="form-group">
            <label for="startDate">Start Date:</label>
            <input type="text" class="form-control" id="startDate" name="startDate" th:value="${search.startDate}">
        </div>
        <div class="form-group">
            <label for="endDate">End Date:</label>
            <input type="text" class="form-control" id="endDate" name="endDate" th:value="${search.endDate}">
        </div>
        <div class="btn-group my-4"> 
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
    </form>
    <form th:action="@{/search/delete/{id}(id=${search.id})}" method="post">
          <button type="submit" class="btn btn-danger">Delete</button>
    </form>
</div>

<script>
document.getElementById("searchForm").addEventListener("submit", function(event) {
    var airportInput = document.getElementById("airport");
    var startInput = document.getElementById("start");
    var endInput = document.getElementById("end");

    // Validate Airport (4-letter ICAO code)
    var airportPattern = /^[A-Z]{4}$/;
    if (!airportPattern.test(airportInput.value.trim())) {
        alert("Airport must be a 4-letter ICAO code all in uppercase.");
        event.preventDefault();
        return false;
    }

    // Validate Date and Time Format (MM-dd-yyyy HH:mm:ss)
    var dateTimePattern = /^\d{2}-\d{2}-\d{4} \d{2}:\d{2}:\d{2}$/;
    if (!dateTimePattern.test(startInput.value.trim()) || !dateTimePattern.test(endInput.value.trim())) {
        alert("Start and End Time must be in the format 'MM-dd-yyyy HH:mm:ss'");
        event.preventDefault();
        return false;
    }

    // Convert start and end times to Date objects for comparison
    var startDate = new Date(startInput.value);
    var endDate = new Date(endInput.value);

    // Check if the end date is before the start date
    if (endDate <= startDate) {
        alert("End Time must be after Start Time.");
        event.preventDefault();
        return false;
    }

    // Calculate the time difference in milliseconds
    var timeDifference = endDate - startDate;
    var daysDifference = timeDifference / (1000 * 60 * 60 * 24);

    // Check if the time interval is more than 7 days
    if (daysDifference > 7) {
        alert("Time interval must not be more than 7 days apart.");
        event.preventDefault();
        return false;
    }
});

// Function to redirect based on search type
function redirectToPage(searchType) {
    searchType = searchType.toLowerCase();
    if (searchType === 'arrival' || searchType === 'departure') {
        window.location.href = '/' + searchType + 's'; // Redirect to either arrivals or departures
    } else {
        alert("Invalid search type");
    }
}
</script>
<script>
document.getElementById("searchForm").addEventListener("submit", function(event) {
    // ... (your existing validation and form handling code)

    fetch("/editSearch", {
        method: "POST",
        body: new FormData(event.target),
        headers: {
            "Accept": "application/json",
            "Content-Type": "application/x-www-form-urlencoded"
        }
    })
    .then(response => {
        if (!response.ok) {
            if (response.status === 404) {
                // Redirect to the custom error page
                window.location.href = "/404error.html";
                event.preventDefault(); // Prevent the form from submitting
            } else {
                // Handle other errors (optional)
                console.error("HTTP error:", response.status, response.statusText);
            }
        } else {
            // Process the successful response (if needed)
        }
    })
    .catch(error => {
        console.error("Fetch error:", error);
    });
});

</script>



<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/editSearch.js"></script>
</body>
</html>
